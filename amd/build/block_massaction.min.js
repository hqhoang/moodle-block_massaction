define(["jquery","core/str"],function(a,b){return{init:function(b){this.data=b,this.drawCheckboxes(this.data),this.populateMenus(this.data),a("#block-massaction-selectall").on("click",this.data,this.selectAllHandler),a("#block-massaction-selectsome").on("change",this.data,this.selectAllHandler),a("#block-massaction-selectnone").on("click",this.data,this.selectAllHandler),a("#block-massaction-outdent").on("click",this.data,this.actionHandler),a("#block-massaction-indent").on("click",this.data,this.actionHandler),a("#block-massaction-hide").on("click",this.data,this.actionHandler),a("#block-massaction-show").on("click",this.data,this.actionHandler),a("#block-massaction-delete").on("click",this.data,this.actionHandler),a("#block-massaction-move").on("change",this.data,this.actionHandler),a("#block-massaction-clone").on("change",this.data,this.actionHandler)},drawCheckboxes:function(b){var c="",d="",e="",f=0,g=0,h=0;for(h in b.sectionmodules)if(null!==h&&0!==a("#section-"+h).length){e=h+" ul.section li.activity div.mod-indent-outer div",c=a("#section-"+e).children("span.actions");for(g in b.sectionmodules[h])f=b.sectionmodules[h][g],d=document.createElement("input"),d.type="checkbox",d.id="massaction-input-"+f,d.className="massaction-checkbox",c[g].appendChild(d)}},populateMenus:function(b){var c=["block-massaction-selectsome","block-massaction-move","block-massaction-clone"],d=0,e="",f=0;for(f in b.sectionnames)for(d in c)e=document.createElement("option"),e.text=b.sectionnames[f],e.value=f,"block-massaction-selectsome"===c[d]?f in b.sectionmodules?e.disabled=!1:e.disabled=!0:e.disabled=!1,a("#"+c[d]).append(e)},selectAllHandler:function(b){var c=!1,d=!1,e=!1,f="",g="",h="";switch(b.currentTarget.id){case"block-massaction-selectsome":e=!0;case"block-massaction-selectnone":d=!0,a("#block-massaction-selected-all").val("false");case"block-massaction-selectall":d||(c=!0,a("#block-massaction-selected-all").val("true"));for(f in b.data.sectionmodules)for(h in b.data.sectionmodules[f])g=b.data.sectionmodules[f][h],a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).prop("checked",c);if(e===!0){f=b.target.value;for(h in b.data.sectionmodules[f])g=b.data.sectionmodules[f][h],a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).prop("checked",!0)}else a("#block-massaction-selectsome").val("all")}},actionHandler:function(c){var d=new Array,e=0,f=c.data.courseformat,g="",h=null,i=0,j=a("#block-massaction-selectsome").val(),k="";if("onetopic"===f){var l=a("li.active:eq(0)"),m=l[0].textContent,n=a("li[aria-label='"+m+"']").attr("id");n=n.split("-"),e=n[1]}a("#block-massaction-selected-section").val(j);var o=c.currentTarget.id.split("-"),p=o[o.length-1];switch(j){case"all":for(j in c.data.sectionmodules)for(h in c.data.sectionmodules[j])g=c.data.sectionmodules[j][h],("onetopic"===f&&e===j||"onetopic"!==f)&&a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).is(":checked")?d.push(g):"true"===a("#block-massaction-selected-all").val()&&"onetopic"===f&&e!==j&&d.push(g);break;default:for(h in c.data.sectionmodules[j])g=c.data.sectionmodules[j][h],("onetopic"===f&&e===j||"onetopic"!==f)&&a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).is(":checked")?d.push(g):"onetopic"===f&&e!==j&&d.push(g)}switch(i=d.length,p){case"delete":if(i>0){var q=b.get_string("confirmation","block_massaction",i);a.when(q).done(function(a){return!!window.confirm(a)})}break;case"move":case"clone":k=a("#block-massaction-"+p).val()}if(a("#block-massaction-action").val(p),a("#block-massaction-activities").val(JSON.stringify(d)),a("#block-massaction-target").val(k),i>0)a("#block-massaction-control-form").submit();else{var r=b.get_string("noitemselected","block_massaction");a.when(r).done(function(a){window.alert(a)})}}}});
