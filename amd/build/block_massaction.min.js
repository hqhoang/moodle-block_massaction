define(["jquery","core/str"],function(a,b){return{init:function(b){this.data=b,this.drawCheckboxes(this.data),this.populateMenus(this.data),a("#block-massaction-selectall").on("click",this.data,this.selectAllHandler),a("#block-massaction-selectsome").on("change",this.data,this.selectAllHandler),a("#block-massaction-selectnone").on("click",this.data,this.selectAllHandler),a("#block-massaction-outdent").on("click",this.data,this.actionHandler),a("#block-massaction-indent").on("click",this.data,this.actionHandler),a("#block-massaction-hide").on("click",this.data,this.actionHandler),a("#block-massaction-show").on("click",this.data,this.actionHandler),a("#block-massaction-delete").on("click",this.data,this.actionHandler),a("#block-massaction-move").on("change",this.data,this.actionHandler),a("#block-massaction-clone").on("change",this.data,this.actionHandler),this.showBlock()},drawCheckboxes:function(b){var c="",d="",e="",f=0,g=0,h=0;for(h in b.sectionmodules)if(null!==h&&0!==a("#section-"+h).length){e=h+" ul.section li.activity div.mod-indent-outer div",c=a("#section"+e).children("span.actions");for(g in b.sectionmodules[h])null!==g&&(f=b.sectionmodules[h][g],d=document.createElement("input"),d.type="checkbox",d.id="massaction-input-"+f,d.className="massaction-checkbox",c[g].append(d))}},populateMenus:function(b){var c=["block-massaction-selectsome","block-massaction-move","block-massaction-clone"],d=0,e="",f=0;for(f in b.sectionnames)if(null!==f)for(d in c)null!==d&&(e=document.createElement("option"),e.text=b.sectionnames[f],e.value=f,"block-massaction-selectsome"===c[d]?f in b.sectionmodules?e.disabled=!1:e.disabled=!0:e.disabled=!1,a("#"+c[d]).append(e))},selectAllHandler:function(b){var c=!1,d=!1,e=!1,f="",g="",h="";if("block-massaction-selectall"==b.currentTarget.id?c=!0:"block-massaction-deselectall"==b.currentTarget.id?d=!0:"block-massaction-selectsome"==b.currentTarget.id&&(d=!0,e=!0),d===!0){a("#block-massaction-selected-all").val("false");for(f in b.data.sectionmodules)if(null!==f)for(h in b.data.sectionmodules[f])null!==h&&(g=b.data.sectionmodules[f][h],a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).prop("checked",!1));if(e===!0&&(f=b.target.value,"all"!==f))for(h in b.data.sectionmodules[f])null!==h&&(g=b.data.sectionmodules[f][h],a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).prop("checked",!0))}else if(c===!0){a("#block-massaction-selected-all").val("true");for(f in b.data.sectionmodules)if(null!==f)for(h in b.data.sectionmodules[f])null!==h&&(g=b.data.sectionmodules[f][h],a("#massaction-input-"+g).length>0&&a("#massaction-input-"+g).prop("checked",!0))}},actionHandler:function(c){var d=new Array,e=c.data.courseformat,f="",g=null,h=0,i=a("#block-massaction-selectsome").val(),j="";if("onetopic"===e){var k=a("li.active:eq(0)"),l=k[0].textContent,m=a("li[aria-label='"+l+"']").attr("id");m=m.split("-");var n=m[1]}a("#block-massaction-selected-section").val(i);var o=c.currentTarget.id.split("-"),p=o[o.length-1];if("true"!==a("#block-massaction-selected-all").val)if("all"===i){for(i in c.data.sectionmodules)if(null!==i)for(g in c.data.sectionmodules[i])null!==g&&(f=c.data.sectionmodules[i][g],a("#massaction-input-"+f).length>0&&a("#massaction-input-"+f).is(":checked")&&d.push(f))}else for(g in c.data.sectionmodules[i])null!==g&&(f=c.data.sectionmodules[i][g],"onetopic"===e?n===i?a("#massaction-input-"+f).length>0&&a("#massaction-input-"+f).is(":checked")&&d.push(f):d.push(f):a("#massaction-input-"+f).length>0&&a("#massaction-input-"+f).is(":checked")&&d.push(f));else for(i in c.data.sectionmodules)if(null!==i)for(g in c.data.sectionmodules[i])null!==g&&(f=c.data.sectionmodules[i][g],"onetopic"===e?n===i&&(a("#massaction-input-"+f).length>0&&a("#massaction-input-"+f).is(":checked")?d.push(f):d.push(f)):a("#massaction-input-"+f).length>0&&a("#massaction-input-"+f).is(":checked")&&d.push(f));switch(h=d.length,p){case"delete":if(h>0){var q=b.get_string("confirmation","block_massaction",h);a.when(q).done(function(a){if(!window.confirm(a))return!1})}break;case"move":case"clone":j=a("#block-massaction-"+p).val()}if(a("#block-massaction-action").val(p),a("#block-massaction-activities").val(JSON.stringify(d)),a("#block-massaction-target").val(j),h>0)a("#block-massaction-control-form").submit();else{var r=b.get_string("noitemselected","block_massaction");a.when(r).done(window.alert(r))}},showBlock:function(){a("div.block-massaction-jsdisabled").addClass("hidden"),a("div.block-massaction-jsenabled").removeClass("hidden")}}});